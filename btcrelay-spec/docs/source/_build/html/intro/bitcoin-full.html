

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Bitcoin &mdash; Polkadot BTC-Relay 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: grey" >
          

          
            <a href="../index.html" class="icon icon-home"> Polkadot BTC-Relay
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="at-a-glance.html">BTC-Relay at a Glance</a></li>
<li class="toctree-l1"><a class="reference internal" href="bitcoin.html">Bitcoin Data Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">BTC-Relay Architecture</a></li>
</ul>
<p class="caption"><span class="caption-text">Specification</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../spec/data-model.html">Data Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spec/functions.html">Functions: Storage and Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spec/helpers.html">Functions: Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spec/parser.html">Functions: Parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spec/events.html">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spec/errors.html">Error Codes</a></li>
</ul>
<p class="caption"><span class="caption-text">Security and Performance</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../security_performance/security.html">Security Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security_performance/performance.html">Performance and Costs</a></li>
</ul>
<p class="caption"><span class="caption-text">All the rest</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../other/license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Polkadot BTC-Relay</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Bitcoin</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/intro/bitcoin-full.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="bitcoin">
<h1>Bitcoin<a class="headerlink" href="#bitcoin" title="Permalink to this headline">¶</a></h1>
<p>This is a quick overview of Bitcoin, containing information necessary to understand the operation of BTC-Relay.</p>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Bitcoin is an electronic peer-to-peer cash system introduced in the <a class="reference external" href="https://bitcoin.org/bitcoin.pdf">Bitcoin whitepaper</a>.
Bitcoin uses the Nakamoto consensus rules to decide which blocks, and thereby which transactions, to include in its ledger.
Nakamoto consensus uses the longest-chain rule to determine which chain of blocks contains the most work, i.e. proof-of-work (PoW).
The longest chain is considered to currently <em>valid</em> chain.</p>
<div class="section" id="longest-chain-and-difficulty-adjustment">
<h3>Longest Chain and Difficulty Adjustment<a class="headerlink" href="#longest-chain-and-difficulty-adjustment" title="Permalink to this headline">¶</a></h3>
<p>The longest chain can be extended by miners adding new blocks.
Miners can attach a new block to the chain of blocks by finding a hash that satisfies a target difficulty.
The target difficulty describes how many leading zeros a block hash has to have.
When miners construct a new block, the block hash consists of the previous block header hash and the data contained in the current block.
A miner then needs to add a nonce to the current block header hash to meet the difficulty criteria.
Bitcoin uses a double <a class="reference external" href="https://en.wikipedia.org/wiki/SHA-2">SHA256</a> hashing algorithm for its block construction.
The core idea behind using a nonce to find a specific target difficulty is that a miner can do not better than randomly guessing the nonce.</p>
<p>Bitcoin accounts for the increase of computation power.
An increase of computation power means that miners can find new blocks in ever shorter time periods as their processing power to calculate the sha256 hash.
As a consequence, Bitcoin adjust the target difficulty every 2016 blocks, i.e. it is increasingly difficult to find a new block.</p>
</div>
<div class="section" id="transactions">
<h3>Transactions<a class="headerlink" href="#transactions" title="Permalink to this headline">¶</a></h3>
<p>Each blocks contains at least on transaction - the coinbase transaction.
The <a class="reference external" href="https://bitcoin.org/en/glossary/coinbase-transaction">coinbase transaction</a> is included by the miner and transfers the reward for finding a block to the miner.
However, typically, a block contains more transactions as miner receive a transaction fee for including transactions.
These are transactions broadcasted by users of the Bitcoin system.</p>
</div>
<div class="section" id="unspent-transaction-output-utxo">
<h3>Unspent Transaction Output (UTXO)<a class="headerlink" href="#unspent-transaction-output-utxo" title="Permalink to this headline">¶</a></h3>
<p>Transactions in Bitcoin are included based on the <a class="reference external" href="https://bitcoin.org/en/blockchain-guide#introduction">Unspent Transaction Output (UTXO) model</a>.
Each new transaction needs to specify which transaction output it is going to spend.
The new transaction then needs to comply with the spending conditions of that output.
For example, the to-be-spent transaction output could require that the transaction can only be spend from a specific public key.
The spender would then need to prove that she is the owner of that public key in the spending transaction.
The spending transaction in turn an create one or more outputs.</p>
</div>
</div>
<div class="section" id="data-model">
<h2>Data Model<a class="headerlink" href="#data-model" title="Permalink to this headline">¶</a></h2>
<p>This specification includes selected Bitcoin data model references. For the full details, refer to <a class="reference external" href="https://bitcoin.org/en/developer-reference">https://bitcoin.org/en/developer-reference</a>.</p>
<div class="section" id="block-headers">
<h3>Block Headers<a class="headerlink" href="#block-headers" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://bitcoin.org/en/developer-reference#block-headers">80 bytes block header hash</a> encodes the following information:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 3%" />
<col style="width: 13%" />
<col style="width: 5%" />
<col style="width: 78%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bytes</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>4</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">version</span></code></p></td>
<td><p>u32</p></td>
<td><p>The block version to follow.</p></td>
</tr>
<tr class="row-odd"><td><p>32</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">hashPrevBlock</span></code></p></td>
<td><p>char[32]</p></td>
<td><p>The double sha256 hash of the previous block header.</p></td>
</tr>
<tr class="row-even"><td><p>32</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">merkleRoot</span></code></p></td>
<td><p>char[32]</p></td>
<td><p>The double sha256 hash of the Merkle root of all transaction hashes in this block.</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">time</span></code></p></td>
<td><p>u32</p></td>
<td><p>The block timestamp included by the miner.</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nBits</span></code></p></td>
<td><p>u32</p></td>
<td><p>The target difficulty threshold, see also the <a class="reference external" href="https://bitcoin.org/en/developer-reference#target-nbits">Bitcoin documentation</a>.</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nonce</span></code></p></td>
<td><p>u32</p></td>
<td><p>The nonce chosen by the miner to meet the target difficulty threshold.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id1">
<h3>Transactions<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>A transaction is broadcasted in a serialized byte format (also called raw format). It consists of a variable size of bytes and has the following <a class="reference external" href="https://bitcoin.org/en/developer-reference#raw-transaction-format">format</a>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 7%" />
<col style="width: 31%" />
<col style="width: 13%" />
<col style="width: 49%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bytes</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>4</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">version</span></code></p></td>
<td><p>i32</p></td>
<td><p>Transaction version number.</p></td>
</tr>
<tr class="row-odd"><td><p>var</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">tx_in</span> <span class="pre">count</span></code></p></td>
<td><p>uint</p></td>
<td><p>Number of transaction inputs.</p></td>
</tr>
<tr class="row-even"><td><p>var</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">tx_in</span></code></p></td>
<td><p>txIn</p></td>
<td><p>Transaction inputs.</p></td>
</tr>
<tr class="row-odd"><td><p>var</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">tx_out</span> <span class="pre">count</span></code></p></td>
<td><p>uint</p></td>
<td><p>The number of transaction outputs.</p></td>
</tr>
<tr class="row-even"><td><p>var</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">tx_out</span></code></p></td>
<td><p>txOut</p></td>
<td><p>Transaction outputs.</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">lock_time</span></code></p></td>
<td><p>u32</p></td>
<td><p>A Unix timestamp OR block number.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="inputs">
<h3>Inputs<a class="headerlink" href="#inputs" title="Permalink to this headline">¶</a></h3>
<p>Bitcoin’s UTXO model requires a new transaction to spend at least one existing and unspent transaction output as a transaction input. The <code class="docutils literal notranslate"><span class="pre">txIn</span></code> type consists of the following bytes. See the <a class="reference external" href="https://bitcoin.org/en/developer-reference#txin">reference</a> for further details.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 4%" />
<col style="width: 16%" />
<col style="width: 7%" />
<col style="width: 74%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bytes</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>36</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">previous_output</span></code></p></td>
<td><p>outpoint</p></td>
<td><p>The output to be spent consisting of the transaction hash (32 bytes) and the output index (4 bytes).</p></td>
</tr>
<tr class="row-odd"><td><p>var</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">script</span> <span class="pre">bytes</span></code></p></td>
<td><p>uint</p></td>
<td><p>Number of bytes in the signature script (max 10,000 bytes).</p></td>
</tr>
<tr class="row-even"><td><p>var</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">signature</span> <span class="pre">script</span></code></p></td>
<td><p>char[]</p></td>
<td><p>The script satisfying the output’s script.</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">sequence</span></code></p></td>
<td><p>u32</p></td>
<td><p>Sequence number (default <code class="docutils literal notranslate"><span class="pre">0xffffffff</span></code>).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="outputs">
<h3>Outputs<a class="headerlink" href="#outputs" title="Permalink to this headline">¶</a></h3>
<p>The transaction output has the following format according to the <a class="reference external" href="https://bitcoin.org/en/developer-reference#txout">reference</a>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 7%" />
<col style="width: 31%" />
<col style="width: 13%" />
<col style="width: 49%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bytes</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">value</span></code></p></td>
<td><p>i64</p></td>
<td><p>Number of satoshis to be spend.</p></td>
</tr>
<tr class="row-odd"><td><p>1+</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pk_script</span> <span class="pre">bytes</span></code></p></td>
<td><p>uint</p></td>
<td><p>Number of bytes in the script.</p></td>
</tr>
<tr class="row-even"><td><p>var</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pk_script</span></code></p></td>
<td><p>char[]</p></td>
<td><p>Spending condition as script.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="merkle-tree-paths">
<h3>Merkle tree Paths<a class="headerlink" href="#merkle-tree-paths" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://bitcoin.org/en/developer-reference#merkle-trees">Merkle tree path</a> allows to reconstruct the Merkle root of the tree from a given transaction hash. The Merkle tree is constructed given all transactions with their index, i.e. their position in the tree. Then each pair of transactions is hashed. The resulting hashes are then paired again until, eventually, only a single hash remains: the Merkle root.</p>
<p>Given a single transaction hash and its index in the tree, it is possible to calculate the root if we know all the pairings of that hash along the tree.
The figure below shows an example of this.
If we know the hash of transaction <code class="docutils literal notranslate"><span class="pre">tx1</span></code> and know that it is at position <code class="docutils literal notranslate"><span class="pre">1</span></code> in the tree we can calculate the Merkle root given the hashes in the red boxes.
First, we hash together <code class="docutils literal notranslate"><span class="pre">tx0</span></code> and <code class="docutils literal notranslate"><span class="pre">tx1</span></code>.
Since we know that <code class="docutils literal notranslate"><span class="pre">tx1</span></code> is at index <code class="docutils literal notranslate"><span class="pre">1</span></code>, the hash of <code class="docutils literal notranslate"><span class="pre">tx0</span></code> must be precede <code class="docutils literal notranslate"><span class="pre">tx1</span></code>’s hash in the calculation.
We then know that we have calculated the left hand side hash <code class="docutils literal notranslate"><span class="pre">hash(tx0</span> <span class="pre">|</span> <span class="pre">tx1)</span></code>.
Given the hash on the right hand side, <code class="docutils literal notranslate"><span class="pre">hash</span> <span class="pre">(tx2</span> <span class="pre">|</span> <span class="pre">tx2)</span></code>, we then take the left hand and the right hand side as inputs to calculate the Merkle root as <code class="docutils literal notranslate"><span class="pre">hash(hash(tx0</span> <span class="pre">|</span> <span class="pre">tx1)</span> <span class="pre">|</span> <span class="pre">hash(tx2</span> <span class="pre">|</span> <span class="pre">tx2))</span></code>.</p>
<div class="figure align-default" id="id3">
<img alt="Merkle tree path diagram" src="../_images/data-model.png" />
<p class="caption"><span class="caption-text">A diagram showing the Merkle tree for a block with three transactions (tx0, tx1, and tx2). The Merkle root is constructed by hashing the transactions pairwise. In red, the Merkle path for tx1 is given.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="data-format-considerations">
<h3>Data Format Considerations<a class="headerlink" href="#data-format-considerations" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><strong>Endianness</strong>:
Bitcoin uses <a class="reference external" href="https://en.wikipedia.org/wiki/Endianness">little endian</a> to represent bytes. That means, the most significant byte is the last byte in a given byte representation. This conversion needs to be accounted for when using Bitcoin data, extracted from the RPC API, as input to BTC-Relay.</p></li>
</ul>
</div>
</div>
<div class="section" id="cryptographic-primitives">
<h2>Cryptographic Primitives<a class="headerlink" href="#cryptographic-primitives" title="Permalink to this headline">¶</a></h2>
<p>Bitcoin’s Cryptographic Primitives</p>
<ul class="simple">
<li><p><strong>ECDSA secp256k1</strong>: Bitcoin uses the <a class="reference external" href="https://en.bitcoin.it/wiki/Secp256k1">secp256k1</a> parameters for its elliptic curve together with the <a class="reference external" href="https://en.bitcoin.it/wiki/Elliptic_Curve_Digital_Signature_Algorithm">ECDSA</a> algorithm for its public-key cryptography.</p></li>
<li><p><strong>SHA-256</strong>: Bitcoin uses a double sha256 hash function for constructing the Merkle trees, the proof of work algorithm, and the creation of Bitcoin addresses. To prevent against <a class="reference external" href="https://en.wikipedia.org/wiki/Length_extension_attack">“length-extension” attacks</a>, Bitcoin uses the double sha256.</p></li>
<li><p><strong>RIPEMD-160</strong>: Bitcoin uses a second hash function, <a class="reference external" href="https://en.bitcoin.it/wiki/RIPEMD-160">RIPEMD-160</a>, to produce short hashes of length 160 bits. Due to possible interactions between <a class="reference external" href="https://bitcoin.stackexchange.com/questions/9202/why-does-bitcoin-use-two-hash-functions-sha-256-and-ripemd-160-to-create-an-ad/9216#9216">ECDSA and RIPEMD-160</a>, Bitcoin uses sha256 in between the two for key generation.</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Interlay

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>